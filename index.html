
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XVI EAC - Organizador Central</title>
    
    <!-- Fontes elegantes estilo Apple -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=SF+Pro+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

    <style>
        :root {
            /* Cores modo claro - inspiradas no iOS */
            --primary: #007AFF;
            --primary-light: #5AC8FA;
            --primary-dark: #0051D5;
            --secondary: #5856D6;
            --accent: #FF9500;
            --success: #34C759;
            --warning: #FF9500;
            --danger: #FF3B30;
            
            --bg-primary: #F2F2F7;
            --bg-secondary: #FFFFFF;
            --bg-tertiary: #F9F9FB;
            --bg-elevated: #FFFFFF;
            
            --text-primary: #000000;
            --text-secondary: #3C3C43;
            --text-tertiary: #8E8E93;
            --text-quaternary: #C7C7CC;
            
            --border-primary: #C6C6C8;
            --border-secondary: #E5E5EA;
            --border-tertiary: #F2F2F7;
            
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.12);
            --shadow-xl: 0 16px 40px rgba(0, 0, 0, 0.16);
            
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            
            --transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --transition-fast: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        [data-theme="dark"] {
            --primary: #0A84FF;
            --primary-light: #64D2FF;
            --primary-dark: #0969DA;
            --secondary: #5E5CE6;
            --accent: #FF9F0A;
            --success: #30D158;
            --warning: #FF9F0A;
            --danger: #FF453A;
            
            --bg-primary: #000000;
            --bg-secondary: #1C1C1E;
            --bg-tertiary: #2C2C2E;
            --bg-elevated: #1C1C1E;
            
            --text-primary: #FFFFFF;
            --text-secondary: #EBEBF5;
            --text-tertiary: #EBEBF5;
            --text-quaternary: #48484A;
            
            --border-primary: #38383A;
            --border-secondary: #48484A;
            --border-tertiary: #2C2C2E;
            
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.5);
            --shadow-xl: 0 16px 40px rgba(0, 0, 0, 0.6);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Inter', system-ui, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: var(--transition);
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 32px;
            padding-top: 20px;
        }

        .header h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 16px;
            letter-spacing: -0.02em;
        }

        .motto-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border-secondary);
            border-radius: var(--radius-lg);
            padding: 20px;
            cursor: pointer;
            transition: var(--transition);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-sm);
        }

        .motto-container:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .motto-container:active {
            transform: scale(0.98);
        }

        #motto-text {
            font-size: 1.1rem;
            font-style: italic;
            color: var(--text-secondary);
            font-weight: 500;
            min-height: 24px;
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            position: sticky;
            top: 20px;
            z-index: 100;
            background: var(--bg-primary);
            padding: 8px 0;
            border-radius: var(--radius-lg);
        }

        .search-container {
            flex: 1;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--border-secondary);
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 16px;
            font-weight: 500;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
            backdrop-filter: blur(10px);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.15);
            transform: translateY(-1px);
        }

        .search-input::placeholder {
            color: var(--text-tertiary);
            font-weight: 400;
        }

        .theme-toggle {
            width: 48px;
            height: 48px;
            border: 1px solid var(--border-secondary);
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
            backdrop-filter: blur(10px);
        }

        .theme-toggle:hover {
            color: var(--primary);
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .theme-toggle:active {
            transform: scale(0.95);
        }

        .theme-toggle .icon {
            width: 20px;
            height: 20px;
            transition: var(--transition);
        }

        .theme-toggle .icon-sun,
        .theme-toggle .icon-moon {
            display: none;
        }

        [data-theme="light"] .theme-toggle .icon-moon {
            display: block;
        }

        [data-theme="dark"] .theme-toggle .icon-sun {
            display: block;
        }

        /* Items Grid */
        .items-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 100px;
        }

        .item-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-secondary);
            border-radius: var(--radius-lg);
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            text-decoration: none;
            color: inherit;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .item-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent, rgba(0, 122, 255, 0.02));
            opacity: 0;
            transition: var(--transition);
        }

        .item-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .item-card:hover::before {
            opacity: 1;
        }

        .item-card:active {
            transform: translateY(0) scale(0.98);
        }

        /* Drag Handle - SEMPRE VISÍVEL */
        .drag-handle {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-tertiary);
            cursor: grab;
            transition: var(--transition-fast);
            border-radius: var(--radius-sm);
            flex-shrink: 0;
        }

        .drag-handle:hover {
            color: var(--primary);
            background: rgba(0, 122, 255, 0.1);
        }

        .drag-handle:active {
            cursor: grabbing;
            transform: scale(1.1);
        }

        .drag-handle .icon {
            width: 18px;
            height: 18px;
        }

        .item-icon {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-md);
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
            box-shadow: var(--shadow-sm);
        }

        .item-icon .icon {
            width: 20px;
            height: 20px;
        }

        .item-content {
            flex: 1;
            min-width: 0;
            pointer-events: none;
        }

        .item-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
            line-height: 1.3;
            /* Quebra de linha inteligente para títulos longos */
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
        }

        .item-note {
            font-size: 0.95rem;
            color: var(--text-secondary);
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        /* Actions - SEMPRE VISÍVEIS */
        .item-actions {
            display: flex;
            gap: 6px;
            flex-shrink: 0;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: var(--radius-sm);
            background: transparent;
            color: var(--text-tertiary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
        }

        .action-btn:hover {
            background: rgba(0, 122, 255, 0.1);
            color: var(--primary);
            transform: scale(1.1);
        }

        .action-btn.view-btn:hover {
            background: rgba(52, 199, 89, 0.1);
            color: var(--success);
        }

        .action-btn.delete-btn:hover {
            background: rgba(255, 59, 48, 0.1);
            color: var(--danger);
        }

        .action-btn .icon {
            width: 16px;
            height: 16px;
        }

        /* Sortable states */
        .item-card.sortable-chosen {
            box-shadow: var(--shadow-xl);
            transform: scale(1.05);
            z-index: 1000;
        }

        .item-card.sortable-ghost {
            opacity: 0.3;
            background: var(--bg-tertiary);
        }

        .item-card.sortable-drag {
            box-shadow: var(--shadow-xl);
            transform: rotate(2deg) scale(1.05);
        }

        /* FAB */
        .fab {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            z-index: 1000;
        }

        .fab:hover {
            transform: scale(1.1) translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .fab:active {
            transform: scale(0.95);
        }

        .fab .icon {
            width: 24px;
            height: 24px;
        }

        /* Modal moderno estilo Apple */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            padding: 32px;
            width: 90%;
            max-width: 480px;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border-secondary);
            transform: translateY(20px) scale(0.95);
            transition: var(--transition);
            backdrop-filter: blur(20px);
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal.active .modal-content {
            transform: translateY(0) scale(1);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 24px;
            color: var(--text-primary);
            text-align: center;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 16px;
            border: 1px solid var(--border-secondary);
            border-radius: var(--radius-md);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 16px;
            font-weight: 500;
            transition: var(--transition);
            resize: none;
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
            line-height: 1.5;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.15);
            background: var(--bg-secondary);
        }

        .form-input::placeholder,
        .form-textarea::placeholder {
            color: var(--text-tertiary);
            font-weight: 400;
        }

        /* Buttons */
        .btn {
            padding: 16px 24px;
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-height: 48px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid var(--border-secondary);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-color: var(--primary);
            transform: translateY(-1px);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 32px;
        }

        .modal-actions .btn {
            flex: 1;
        }

        /* Choice Modal */
        .choice-modal .modal-content {
            max-width: 320px;
            text-align: center;
        }

        .choice-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 24px;
        }

        .choice-btn {
            padding: 24px 16px;
            flex-direction: column;
        }

        .choice-btn .icon {
            width: 24px;
            height: 24px;
            margin-bottom: 8px;
        }

        /* View Modal */
        .view-modal .note-content {
            background: var(--bg-tertiary);
            padding: 24px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-secondary);
            margin: 16px 0;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 1rem;
        }

        /* States */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-tertiary);
        }

        .empty-state .icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 16px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-secondary);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .search-highlight {
            background: rgba(0, 122, 255, 0.2);
            border-radius: 4px;
            padding: 2px 4px;
            color: var(--primary);
            font-weight: 600;
        }

        #url-group {
            display: none;
        }

        /* Responsividade Mobile-First */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            .header {
                margin-bottom: 24px;
                padding-top: 10px;
            }

            .controls {
                top: 16px;
            }

            .modal-content {
                padding: 24px 20px;
                border-radius: var(--radius-lg);
                max-height: 90vh;
            }

            .modal-title {
                font-size: 1.25rem;
            }

            .fab {
                bottom: 20px;
                right: 20px;
                width: 56px;
                height: 56px;
            }

            .item-card {
                padding: 14px;
                gap: 12px;
            }

            .item-title {
                font-size: 1rem;
            }

            .item-note {
                font-size: 0.9rem;
            }

            .drag-handle {
                width: 28px;
                height: 28px;
            }

            .item-icon {
                width: 40px;
                height: 40px;
            }

            .action-btn {
                width: 32px;
                height: 32px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 12px;
            }

            .choice-buttons {
                gap: 8px;
            }

            .modal-actions {
                flex-direction: column;
            }

            .item-card {
                padding: 12px;
                gap: 10px;
            }
        }

        /* Animações de entrada */
        .item-card {
            animation: slideInUp 0.3s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Touch feedback para mobile */
        @media (hover: none) {
            .item-card:active {
                background: var(--bg-tertiary);
            }
            
            .btn:active {
                transform: scale(0.95);
            }
            
            .action-btn:active {
                background: rgba(0, 122, 255, 0.2);
            }
        }
    </style>
</head>
<body data-theme="light">
    <!-- SVG Icons -->
    <svg style="position: absolute; width: 0; height: 0; overflow: hidden;">
        <symbol id="icon-drag" viewBox="0 0 24 24" fill="currentColor">
            <path d="M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
        </symbol>
        <symbol id="icon-plus" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
            <path d="M12 4.5v15m7.5-7.5h-15"/>
        </symbol>
        <symbol id="icon-edit" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none">
            <path d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"/>
        </symbol>
        <symbol id="icon-delete" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none">
            <path d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.067-2.09 1.02-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"/>
        </symbol>
        <symbol id="icon-sun" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none">
            <circle cx="12" cy="12" r="4"/>
            <path d="M12 2v2M12 20v2m-8.485-8.485l1.414 1.414M18.071 18.071l1.414 1.414M2 12h2M20 12h2M6.343 17.657l-1.414 1.414M18.071 5.929l1.414-1.414"/>
        </symbol>
        <symbol id="icon-moon" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none">
            <path d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z"/>
        </symbol>
        <symbol id="icon-link" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none">
            <path d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"/>
        </symbol>
        <symbol id="icon-note" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none">
            <path d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"/>
        </symbol>
        <symbol id="icon-eye" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none">
            <path d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"/>
            <path d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
        </symbol>
        <symbol id="icon-grid" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none">
            <rect width="7" height="7" x="3" y="3" rx="1"/>
            <rect width="7" height="7" x="14" y="3" rx="1"/>
            <rect width="7" height="7" x="14" y="14" rx="1"/>
            <rect width="7" height="7" x="3" y="14" rx="1"/>
        </symbol>
    </svg>

    <div class="container">
        <header class="header">
            <h1>XVI EAC</h1>
            <div class="motto-container" id="motto-editor" title="Clique para editar a frase">
                <p id="motto-text">Carregando...</p>
            </div>
        </header>

        <div class="controls">
            <div class="search-container">
                <input type="search" class="search-input" id="search-filter" placeholder="Pesquisar por título ou nota...">
            </div>
            <button class="theme-toggle" id="theme-toggle" title="Alternar tema">
                <svg class="icon icon-sun"><use href="#icon-sun"></use></svg>
                <svg class="icon icon-moon"><use href="#icon-moon"></use></svg>
            </button>
        </div>

        <main class="items-grid" id="items-grid">
            <div class="loading" style="margin: 60px auto;"></div>
        </main>
    </div>

    <button class="fab" id="add-btn" title="Adicionar item">
        <svg class="icon"><use href="#icon-plus"></use></svg>
    </button>

    <!-- Choice Modal -->
    <div class="modal choice-modal" id="choice-modal">
        <div class="modal-content">
            <h2 class="modal-title">O que deseja adicionar?</h2>
            <div class="choice-buttons">
                <button class="btn btn-primary choice-btn" id="add-link">
                    <svg class="icon"><use href="#icon-link"></use></svg>
                    Link
                </button>
                <button class="btn btn-secondary choice-btn" id="add-note">
                    <svg class="icon"><use href="#icon-note"></use></svg>
                    Nota
                </button>
            </div>
        </div>
    </div>

    <!-- Form Modal -->
    <div class="modal" id="form-modal">
        <div class="modal-content">
            <h2 class="modal-title" id="form-title">Adicionar Item</h2>
            <form id="item-form">
                <input type="hidden" id="item-id">
                
                <div class="form-group">
                    <label class="form-label" for="item-title">Título</label>
                    <input type="text" class="form-input" id="item-title" required placeholder="Digite o título...">
                </div>
                
                <div class="form-group" id="url-group">
                    <label class="form-label" for="item-url">URL do Link</label>
                    <input type="url" class="form-input" id="item-url" placeholder="https://exemplo.com">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="item-note">Descrição / Nota</label>
                    <textarea class="form-textarea" id="item-note" placeholder="Adicione uma descrição ou nota..."></textarea>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-btn">Cancelar</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="btn-text">Salvar</span>
                        <div class="loading" style="display: none;"></div>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Modal -->
    <div class="modal view-modal" id="view-modal">
        <div class="modal-content">
            <h2 class="modal-title" id="view-title">Visualizar Nota</h2>
            <div class="note-content" id="view-content"></div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="close-view">Fechar</button>
                <button type="button" class="btn btn-primary" id="edit-from-view">
                    <svg class="icon" style="width: 16px; height: 16px;"><use href="#icon-edit"></use></svg>
                    Editar
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc, doc, deleteDoc, updateDoc, serverTimestamp, getDoc, setDoc, writeBatch } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

        // Firebase Configuration
        const firebaseConfig = { 
            apiKey: "AIzaSyCIX7hEmpRZacxbzIxUOzKMuu4l0lXBTQQ", 
            authDomain: "xvi-eac.firebaseapp.com", 
            projectId: "xvi-eac", 
            storageBucket: "xvi-eac.appspot.com", 
            messagingSenderId: "340488873046", 
            appId: "1:340488873046:web:ddc2c775fe977c4d6487f7" 
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Global Variables
        let currentItemType = 'link';
        let currentEditingDoc = null;
        let allItems = [];
        let searchTimeout = null;
        let sortableInstance = null;
        let longPressTimer = null;
        let isDraggingEnabled = false;
        
        // DOM Elements
        const elements = {
            itemsGrid: document.getElementById('items-grid'),
            addBtn: document.getElementById('add-btn'),
            choiceModal: document.getElementById('choice-modal'),
            formModal: document.getElementById('form-modal'),
            viewModal: document.getElementById('view-modal'),
            itemForm: document.getElementById('item-form'),
            formTitle: document.getElementById('form-title'),
            urlGroup: document.getElementById('url-group'),
            cancelBtn: document.getElementById('cancel-btn'),
            themeToggle: document.getElementById('theme-toggle'),
            mottoText: document.getElementById('motto-text'),
            mottoEditor: document.getElementById('motto-editor'),
            searchFilter: document.getElementById('search-filter'),
            viewTitle: document.getElementById('view-title'),
            viewContent: document.getElementById('view-content'),
            closeView: document.getElementById('close-view'),
            editFromView: document.getElementById('edit-from-view')
        };

        // Utility Functions
        const highlightText = (text, query) => {
            if (!query) return text;
            // CORREÇÃO APLICADA AQUI: A linha abaixo estava com HTML colado dentro da string.
            const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            return text.replace(regex, '<span class="search-highlight">$1</span>');
        };

        // Render Functions
        const renderItem = (doc) => {
            const item = doc.data();
            const isLink = item.type === 'link' && item.url;
            const card = document.createElement(isLink ? 'a' : 'div');
            
            card.className = `item-card is-${item.type}`;
            card.dataset.id = doc.id;
            
            if (isLink) {
                card.href = item.url;
                card.target = '_blank';
                card.rel = 'noopener noreferrer';
            }

            card.innerHTML = `
                <div class="drag-handle" title="Pressione e segure para reordenar">
                    <svg class="icon"><use href="#icon-drag"></use></svg>
                </div>
                <div class="item-icon">
                    <svg class="icon"><use href="#icon-${item.type}"></use></svg>
                </div>
                <div class="item-content">
                    <div class="item-title">${item.title || 'Sem título'}</div>
                    <div class="item-note">${item.note || ''}</div>
                </div>
                <div class="item-actions">
                    ${item.type === 'note' ? `<button class="action-btn view-btn" title="Visualizar"><svg class="icon"><use href="#icon-eye"></use></svg></button>` : ''}
                    <button class="action-btn edit-btn" title="Editar"><svg class="icon"><use href="#icon-edit"></use></svg></button>
                    <button class="action-btn delete-btn" title="Excluir"><svg class="icon"><use href="#icon-delete"></use></svg></button>
                </div>
            `;
            
            // Event Listeners para o card
            setupCardEventListeners(card, doc, item, isLink);
            
            elements.itemsGrid.appendChild(card);
        };

        const setupCardEventListeners = (card, doc, item, isLink) => {
            const dragHandle = card.querySelector('.drag-handle');
            const viewBtn = card.querySelector('.view-btn');
            const editBtn = card.querySelector('.edit-btn');
            const deleteBtn = card.querySelector('.delete-btn');

            // Setup drag and drop com long press
            setupDragAndDrop(card, dragHandle);

            // View button
            if (viewBtn) {
                viewBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    openViewModal(doc);
                });
            }
            
            // Click no card para notas
            if (item.type === 'note') {
                card.addEventListener('click', (e) => {
                    if (isLink) return;
                    if (e.target.closest('.item-actions') || e.target.closest('.drag-handle')) return;
                    e.preventDefault();
                    openViewModal(doc);
                });
            }
            
            // Edit button
            editBtn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                openFormModal('edit', doc);
            });
            
            // Delete button
            deleteBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                e.stopPropagation();
                if (confirm(`Excluir "${item.title || 'item'}"?`)) {
                    await deleteItem(doc.id);
                }
            });
        };

        // Drag and Drop com Long Press
        const setupDragAndDrop = (card, dragHandle) => {
            let startY = 0;
            let startTime = 0;
            let hasMoved = false;

            const startLongPress = (e) => {
                startTime = Date.now();
                startY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;
                hasMoved = false;
                
                longPressTimer = setTimeout(() => {
                    if (!hasMoved) {
                        enableDragging();
                        card.classList.add('dragging-enabled');
                        navigator.vibrate && navigator.vibrate(50); // Vibração no mobile
                    }
                }, 800); // 800ms para ativar o drag
            };

            const checkMovement = (e) => {
                const currentY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;
                const deltaY = Math.abs(currentY - startY);
                
                if (deltaY > 10) {
                    hasMoved = true;
                    clearTimeout(longPressTimer);
                }
            };

            const endLongPress = () => {
                clearTimeout(longPressTimer);
                if (Date.now() - startTime < 800 && !hasMoved) {
                    // Tap rápido - scroll normal
                    disableDragging();
                }
            };

            // Touch events
            dragHandle.addEventListener('touchstart', startLongPress, { passive: true });
            dragHandle.addEventListener('touchmove', checkMovement, { passive: true });
            dragHandle.addEventListener('touchend', endLongPress);

            // Mouse events
            dragHandle.addEventListener('mousedown', startLongPress);
            dragHandle.addEventListener('mousemove', checkMovement);
            dragHandle.addEventListener('mouseup', endLongPress);
            dragHandle.addEventListener('mouseleave', endLongPress);
        };

        const enableDragging = () => {
            if (!sortableInstance) {
                sortableInstance = new Sortable(elements.itemsGrid, {
                    handle: '.drag-handle',
                    animation: 250,
                    easing: "cubic-bezier(0.25, 0.46, 0.45, 0.94)",
                    ghostClass: 'sortable-ghost',
                    chosenClass: 'sortable-chosen',
                    dragClass: 'sortable-drag',
                    forceFallback: false,
                    fallbackTolerance: 0,
                    scroll: true,
                    scrollSensitivity: 100,
                    scrollSpeed: 15,
                    onEnd: updateOrder
                });
            }
            sortableInstance.option("disabled", false);
            isDraggingEnabled = true;
        };

        const disableDragging = () => {
            if (sortableInstance) {
                sortableInstance.option("disabled", true);
            }
            isDraggingEnabled = false;
            
            // Remove visual feedback
            document.querySelectorAll('.item-card').forEach(card => {
                card.classList.remove('dragging-enabled');
            });
        };

        // Modal Functions
        const openViewModal = (doc) => {
            const item = doc.data();
            currentEditingDoc = doc;
            elements.viewTitle.textContent = item.title || 'Nota sem título';
            elements.viewContent.textContent = item.note || 'Nota vazia';
            elements.viewModal.classList.add('active');
        };

        const openFormModal = (mode = 'add', docToEdit = null) => {
            elements.itemForm.reset();
            elements.urlGroup.style.display = currentItemType === 'link' ? 'block' : 'none';
            
            if (mode === 'edit' && docToEdit) {
                const item = docToEdit.data();
                currentItemType = item.type;
                currentEditingDoc = docToEdit;
                elements.urlGroup.style.display = currentItemType === 'link' ? 'block' : 'none';
                elements.formTitle.textContent = `Editar ${currentItemType === 'link' ? 'Link' : 'Nota'}`;
                document.getElementById('item-id').value = docToEdit.id;
                document.getElementById('item-title').value = item.title || '';
                document.getElementById('item-url').value = item.url || '';
                document.getElementById('item-note').value = item.note || '';
            } else {
                currentEditingDoc = null;
                elements.formTitle.textContent = `Adicionar ${currentItemType === 'link' ? 'Link' : 'Nota'}`;
                document.getElementById('item-id').value = '';
            }
            
            elements.formModal.classList.add('active');
            setTimeout(() => document.getElementById('item-title').focus(), 300);
        };

        const closeModal = (modal) => {
            modal.classList.remove('active');
            currentEditingDoc = null;
        };

        // Data Functions
        const fetchAll = async () => {
            elements.itemsGrid.innerHTML = '<div class="loading" style="margin: 60px auto;"></div>';
            elements.mottoText.textContent = 'Carregando...';
            
            try {
                const [itemsSnap, mottoSnap] = await Promise.all([
                    getDocs(collection(db, "items")),
                    getDoc(doc(db, "config", "motto"))
                ]);
                
                // Update motto
                if (mottoSnap.exists() && mottoSnap.data().text) {
                    elements.mottoText.textContent = `"${mottoSnap.data().text}"`;
                } else {
                    elements.mottoText.textContent = "Clique para definir a frase guia...";
                }
                
                // Clear grid
                elements.itemsGrid.innerHTML = '';
                
                if (itemsSnap.empty) {
                    elements.itemsGrid.innerHTML = `
                        <div class="empty-state">
                            <svg class="icon"><use href="#icon-grid"></use></svg>
                            <h3>Nenhum item encontrado</h3>
                            <p>Clique no botão + para começar</p>
                        </div>
                    `;
                    allItems = [];
                    return;
                }
                
                // Sort items
                allItems = itemsSnap.docs.sort((a, b) => 
                    (a.data().position ?? Infinity) - (b.data().position ?? Infinity) || 
                    (b.data().createdAt?.seconds ?? 0) - (a.data().createdAt?.seconds ?? 0)
                );
                
                // Render items with animation delay
                allItems.forEach((doc, index) => {
                    setTimeout(() => renderItem(doc), index * 50);
                });
                
            } catch (error) {
                console.error("Erro ao buscar dados:", error);
                elements.itemsGrid.innerHTML = `
                    <div class="empty-state">
                        <p style="color: var(--danger);">Erro ao carregar dados</p>
                    </div>
                `;
                elements.mottoText.textContent = "Erro ao carregar frase";
            }
        };

        const updateMotto = async () => {
            const current = elements.mottoText.textContent.replace(/[""]/g, '');
            const newMotto = prompt("Digite a nova frase guia:", current.includes('Clique') ? '' : current);
            
            if (newMotto !== null && newMotto.trim() !== '') {
                try {
                    await setDoc(doc(db, "config", "motto"), { text: newMotto.trim() });
                    elements.mottoText.textContent = `"${newMotto.trim()}"`;
                } catch (error) {
                    console.error("Erro ao salvar frase:", error);
                    alert("Não foi possível salvar a frase");
                }
            }
        };

        const saveItem = async (e) => {
            e.preventDefault();
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const btnText = submitBtn.querySelector('.btn-text');
            const spinner = submitBtn.querySelector('.loading');
            
            btnText.style.display = 'none';
            spinner.style.display = 'inline-block';
            submitBtn.disabled = true;
            
            const id = document.getElementById('item-id').value;
            const itemData = {
                type: currentItemType,
                title: document.getElementById('item-title').value.trim(),
                url: document.getElementById('item-url').value.trim(),
                note: document.getElementById('item-note').value.trim()
            };
            
            if (!itemData.title) {
                alert('O título é obrigatório');
                btnText.style.display = 'inline';
                spinner.style.display = 'none';
                submitBtn.disabled = false;
                return;
            }
            
            if (currentItemType === 'link' && !itemData.url) {
                alert('A URL é obrigatória para links');
                btnText.style.display = 'inline';
                spinner.style.display = 'none';
                submitBtn.disabled = false;
                return;
            }
            
            try {
                if (id) {
                    await updateDoc(doc(db, "items", id), itemData);
                } else {
                    itemData.createdAt = serverTimestamp();
                    itemData.position = elements.itemsGrid.children.length;
                    await addDoc(collection(db, "items"), itemData);
                }
                
                closeModal(elements.formModal);
                await fetchAll();
            } catch (error) {
                console.error("Erro ao salvar:", error);
                alert("Erro ao salvar item");
            } finally {
                btnText.style.display = 'inline';
                spinner.style.display = 'none';
                submitBtn.disabled = false;
            }
        };

        const deleteItem = async (id) => {
            try {
                await deleteDoc(doc(db, "items", id));
                await fetchAll();
            } catch (error) {
                console.error("Erro ao deletar:", error);
                alert("Erro ao deletar item");
            }
        };

        const updateOrder = async () => {
            try {
                const batch = writeBatch(db);
                const cards = elements.itemsGrid.querySelectorAll('.item-card');
                
                cards.forEach((card, index) => {
                    if (card.dataset.id) {
                        const docRef = doc(db, 'items', card.dataset.id);
                        batch.update(docRef, { position: index });
                    }
                });
                
                await batch.commit();
            } catch (error) {
                console.error("Erro ao atualizar ordem:", error);
            } finally {
                // Disable dragging after reorder
                setTimeout(() => disableDragging(), 1000);
            }
        };

        // Theme Functions
        const applyTheme = (theme) => {
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        };

        // Search Functions
        const filterItems = () => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const query = elements.searchFilter.value.toLowerCase().trim();
                
                if (!query) {
                    document.querySelectorAll('.item-card').forEach(card => {
                        card.style.display = 'flex';
                        card.querySelectorAll('.search-highlight').forEach(highlight => {
                            highlight.outerHTML = highlight.innerHTML;
                        });
                    });
                    
                    const existing = elements.itemsGrid.querySelector('.search-no-results');
                    if (existing) existing.remove();
                    return;
                }
                
                let visibleCount = 0;
                document.querySelectorAll('.item-card').forEach(card => {
                    const titleEl = card.querySelector('.item-title');
                    const noteEl = card.querySelector('.item-note');
                    const title = titleEl.textContent.toLowerCase();
                    const note = noteEl.textContent.toLowerCase();
                    const isVisible = title.includes(query) || note.includes(query);
                    
                    card.style.display = isVisible ? 'flex' : 'none';
                    
                    if (isVisible) {
                        visibleCount++;
                        titleEl.innerHTML = highlightText(titleEl.textContent, query);
                        noteEl.innerHTML = highlightText(noteEl.textContent, query);
                    }
                });
                
                const existing = elements.itemsGrid.querySelector('.search-no-results');
                if (existing) existing.remove();
                
                if (visibleCount === 0) {
                    const noResults = document.createElement('div');
                    noResults.className = 'empty-state search-no-results';
                    noResults.innerHTML = `
                        <h3>Nenhum resultado encontrado</h3>
                        <p>Tente uma busca diferente</p>
                    `;
                    elements.itemsGrid.appendChild(noResults);
                }
            }, 200);
        };

        // Event Listeners
        elements.themeToggle.addEventListener('click', () => {
            const newTheme = document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
            applyTheme(newTheme);
        });

        elements.addBtn.addEventListener('click', () => {
            elements.choiceModal.classList.add('active');
        });

        document.getElementById('add-link').addEventListener('click', () => {
            currentItemType = 'link';
            closeModal(elements.choiceModal);
            openFormModal('add');
        });

        document.getElementById('add-note').addEventListener('click', () => {
            currentItemType = 'note';
            closeModal(elements.choiceModal);
            openFormModal('add');
        });

        elements.cancelBtn.addEventListener('click', () => closeModal(elements.formModal));
        elements.closeView.addEventListener('click', () => closeModal(elements.viewModal));

        elements.editFromView.addEventListener('click', () => {
            closeModal(elements.viewModal);
            if (currentEditingDoc) {
                openFormModal('edit', currentEditingDoc);
            }
        });

        // Modal backdrop clicks
        [elements.formModal, elements.choiceModal, elements.viewModal].forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal(modal);
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (elements.formModal.classList.contains('active')) closeModal(elements.formModal);
                if (elements.choiceModal.classList.contains('active')) closeModal(elements.choiceModal);
                if (elements.viewModal.classList.contains('active')) closeModal(elements.viewModal);
            }
        });

        elements.itemForm.addEventListener('submit', saveItem);
        elements.mottoEditor.addEventListener('click', updateMotto);
        elements.searchFilter.addEventListener('input', filterItems);

        elements.searchFilter.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                elements.searchFilter.value = '';
                filterItems();
                elements.searchFilter.blur();
            }
        });

        // Disable dragging when scrolling
        let isScrolling = false;
        let scrollTimeout;

        document.addEventListener('scroll', () => {
            isScrolling = true;
            clearTimeout(scrollTimeout);
            
            if (isDraggingEnabled) {
                disableDragging();
            }
            
            scrollTimeout = setTimeout(() => {
                isScrolling = false;
            }, 150);
        });

        // Initialize App
        document.addEventListener('DOMContentLoaded', async () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            applyTheme(savedTheme);
            await fetchAll();
        });
    </script>
</body>
</html>
